# âœ… Pre-Deployment Checklist

## Before Running `deploy.sh`

### 1. Code Quality
- [ ] All changes committed to Git
- [ ] No console.log() in production code (or minimal)
- [ ] No hardcoded credentials
- [ ] Environment variables properly set

### 2. Testing
- [ ] App runs locally without errors: `npm run dev`
- [ ] Build succeeds locally: `npm run build`
- [ ] Database migrations work: `npx prisma migrate dev`
- [ ] All features tested

### 3. Git
- [ ] All changes pushed to `main` branch
- [ ] No uncommitted changes: `git status`
- [ ] Latest code on GitHub/GitLab

### 4. Server Checks
- [ ] VPS is accessible: `ssh root@72.60.233.210`
- [ ] Enough disk space: `df -h`
- [ ] Database is running: `sudo systemctl status postgresql`
- [ ] PM2 is installed: `pm2 --version`

### 5. Environment Variables on Server
- [ ] `.env` file exists at `/var/www/pms/.env`
- [ ] `DATABASE_URL` is correct
- [ ] `NEXTAUTH_SECRET` is set
- [ ] `NEXTAUTH_URL` matches your domain
- [ ] `NODE_ENV=production`

---

## Deployment Command

```bash
bash deploy.sh
```

---

## Post-Deployment Verification

### 1. Check PM2 Status
```bash
ssh root@72.60.233.210
pm2 status
```
Should show `pms` as `online`

### 2. Check Logs
```bash
pm2 logs pms --lines 50
```
Should have no errors

### 3. Test Website
- [ ] Homepage loads
- [ ] Login works
- [ ] Admin dashboard accessible
- [ ] Personnel dashboard accessible
- [ ] Payroll generation works
- [ ] Database queries work

### 4. Monitor for 5 Minutes
```bash
pm2 monit
```
Watch for:
- Memory usage stable
- No restarts
- No errors

---

## If Something Goes Wrong

### Option 1: Check Logs
```bash
ssh root@72.60.233.210
pm2 logs pms --lines 100
```

### Option 2: Rollback
```bash
bash rollback.sh
```

### Option 3: Manual Fix
```bash
ssh root@72.60.233.210
cd /var/www/pms
# Fix the issue
npm run build
pm2 restart pms
```

---

## Common Issues & Solutions

### Build Fails
```bash
# Clear cache and rebuild
rm -rf .next node_modules/.cache
npm install --legacy-peer-deps
npm run build
```

### Database Connection Error
```bash
# Check .env file
cat .env | grep DATABASE_URL
# Test connection
npx prisma db pull
```

### Port 3000 Already in Use
```bash
# Find and kill process
lsof -i :3000
kill -9 <PID>
pm2 restart pms
```

### Out of Memory
```bash
# Increase Node memory
pm2 delete pms
pm2 start npm --name "pms" --max-memory-restart 1G -- start
pm2 save
```

---

## Emergency Contacts

- Server IP: 72.60.233.210
- Server Path: /var/www/pms
- PM2 Process Name: pms
- Database: PostgreSQL on localhost:5432

---

## Backup Before Deploy

```bash
# Backup database
ssh root@72.60.233.210
pg_dump -U your_db_user pms_db > /root/backups/pms_$(date +%Y%m%d_%H%M%S).sql
```
